<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml"  xmlns:components="views.components.*"
	horizontalScrollPolicy="off" verticalScrollPolicy="off" show="doShow(event)"
	width="100%" height="100%" backgroundColor="#eeeeee">
	<mx:Script>
		<![CDATA[
			import mx.core.Application;
			import model.vo.SiteVO;
			import views.components.ThreeColumnText;
			
			[Bindable]
			public var site:SiteVO;
			
			// The video.playing property doesn't update fast enough, so we can't rely on it
			private var videoIsPlaying:Boolean = false;
						
			private function doReturnToMap(event:Event):void {
				doStopVid(event);
				vStory.clear();
				vPhotos.resetSelection();
				Application.application.showMap();
			}
			
			private function doPlayVid(event:Event):void {
				if ((vid != null) && !videoIsPlaying){
					vid.play();
					videoIsPlaying = true;
					vid.visible = true;
				}
			}
			
			private function doPauseVid(event:Event):void {
				if ((vid != null) && videoIsPlaying){
					vid.pause();
					videoIsPlaying = false;
				}
			}
			
			private function doStopVid(event:Event):void {
				if (vid != null){
					vid.stop();
					videoIsPlaying = false;
				}
			}
			
			private function doShow(event:Event):void {
				vsSiteProfile.selectedChild = vStory;
				vStory.clear();
				doViewChanged(event);
			}
			
			private function doViewChanged(event:Event):void {
				if (vsSiteProfile.selectedChild != vVideo) {
					doPauseVid(event);
				} else {
					if ((site.videoPath == null) || (site.videoPath == "")){
						if (vid != null){
							vid.visible = false;
						}
					} else {
						doPlayVid(event);
					}
				}
			}
		]]>
	</mx:Script>
	<mx:HBox width="100%" height="200" horizontalAlign="middle" verticalAlign="middle">
		<mx:Spacer width="20" />
		<components:SmoothImage source="{site.profileImagePath}" id="imgProfile" 
		height="100%" width="200" top="10" left="10" />
		<mx:VBox height="100%">
			<mx:Label text="{site.people.names}" fontWeight="bold" fontSize="40" />
			<mx:Label text="{site.locationName}" fontSize="30" />
			<mx:Spacer height="100%" />
		</mx:VBox>
		<mx:Spacer width="100%" />
		<mx:ToggleButtonBar dataProvider="{vsSiteProfile}" />
		<mx:Spacer width="100%" />
		<mx:Button click="doReturnToMap(event)" top="30" right="10" icon="@Embed(source='images/world.png')" />
		<mx:Spacer width="20" />
	</mx:HBox>
	
	<mx:ViewStack id="vsSiteProfile" height="100%" width="100%" change="doViewChanged(event)">
		<components:ThreeColumnText id="vStory" icon="@Embed(source='images/folder.png')" text="{site.people.story}" 
			width="100%" height="100%" paddingTop="50" paddingBottom="50" paddingLeft="50" paddingRight="50" />
					
		<components:PhotoFlow id="vPhotos" 
			dataProvider="{site.galleryImagePaths}" width="100%" icon="@Embed(source='images/digital_camera.png')" />
			
		<mx:VBox id="vVideo" icon="@Embed(source='images/movie_clapboard.png')" verticalAlign="middle" >
			<mx:VideoDisplay id="vid" width="100%" height="100%" source="{site.videoPath}" autoPlay="false" backgroundAlpha="0.0" />
			<mx:Spacer height="1%" />
		</mx:VBox>
	</mx:ViewStack>
</mx:VBox>
